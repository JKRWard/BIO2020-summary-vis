---
title: "Summary statistics and Data visualisation"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(mosaic)
library(ggformula)
library(palmerpenguins) #Add install to bio2020 package
library(datasauRus)     #Add install to bio2020 package
#caterpillers <- read.csv("www/regression.csv")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## Introduction

Now that we are starting to think about analysing some data we need to know some of the basic functions that we can use in R to:

- Generate summary statistics for our dataset (as a whole and for individual variables) `r emo::ji("multiply")` `r emo::ji("abacus")` `r emo::ji("heavy_division_sign")`
- Visualise and plot our data `r emo::ji("bar_chart")``r emo::ji("chart_increasing")`  

## Checking your data 

Once you have collected your data and read it in to R (if you need a recap of reading in data go to xyz) the first thing to do is to check that you have the right data!

Lets start by having a look at some data.
We are going look at some data that contains information about penguins that was collected by researchers at the [palmer research station](https://pal.lternet.edu/)  `r emo::ji("penguin")`

There are a couple of R functions that offer a useful jumping off point for us to get to know our dataset.

+ The `head()` function shows us the first 6 rows of the dataset
+ The `names()` function tells us what the variable names for each column of the datset are

Using the dataset called `penguins` `r emo::ji("penguin")` run the above functions to get an idea of what the dataset contains

```{r data-check, exercise=TRUE, exercise.completion=FALSE}
# The head function shows you the first 6 rows of your data set

# The names function tells you the names of each of your columns
  
 
```

Now that we have checked our data and we are happy that we are looking at the correct data file and we know what all of the variable names are we can start to interrogate it a bit further.

We can check the number of rows and columns using the `dim()` function or using `nrow()` or `ncol()` and we can investigate the structure of our data using `str()`

We can use the `summary()` function to give us a summary of the entire dataset which can be a useful way to identify outliers.

Using the summary function can you find out how much the heaviest penguin weighs?

```{r heavy-penguin, exercise=TRUE, exercise.completion=FALSE}
# Finding the weight of the heaviest penguin
 
```

<div id="heavy-penguin-hint">
**Hint** You can use `args(summary)` to check what inputs the summary function needs. THe object is the data that you want to look at 
</div>

The `summary()` function returns information for each variable, where the data are numeric it computes statistics that are often of interest such as the mean and median.

We could  do this manually for a chosen variable using the `mean()` function from the `mosaic` package
```{r mean-func, echo =TRUE}
# mean weight
mean(~body_mass_g, data = penguins)
```

Looking at the outputs of `summary(penguins)` can you work out why the output of the above code gives NA

```{r mean-q, echo=FALSE}
question("Why does the above code return NA?",
         answer("Because there are NA's in the dataset",
                message = "There are NA's in the dataset but we are focussed on just one variable at the moment"),
         answer("Because there are NA's in the body mass variable", correct = TRUE),
allow_retry = TRUE
         )
```
 
 We can add an argument to the function to tell it to remove the NA's and calculate statistics based on the data available
 
```{r mean-narm, echo = TRUE}

# mean weight
mean(~body_mass_g, data = penguins, na.rm=TRUE)

```


From using the `summary()` function we can see that there are three different species of penguin in our dataset, whilst the above code gives us an indication of the overall mean often we want to compute those same statistics for each group to see if the groups differ from each other.

An easy way to do this is to use functions from the `mosaic` package with the formula: 

$$\text{statistic(variable ~ group, data= dataset)}$$
Where:

+ **statistic** = the statistic that we want to calculate (mean, median, sd, etc.)
+ **variable** = the name of the column containing the variable that we are intersted in 
+ **group** = the name of the column containing information by which we want to group the data

So we can look at the mean of the weight variable according to the species 

```{r sp-weight, echo = TRUE}
mean(body_mass_g ~ species, data= penguins, na.rm=TRUE)

```

We can see that the gentoo penguins are generally heavier than the other two species

How might we modify this code to see if there is any sexual dimporhism among these penguins? 

```{r penguin-dimorphism, exercise=TRUE, exercise.completion=FALSE}
# What is the median weight of male penguins?

# What is the mean weight of female gentoo penguins?
 
```

<div id="penguin-dimorphism-hint">
**Hint** We can add additional grouping factors to the fomula `statistic(variable ~ group1 + group2, data = dataset)`
</div>

Some of the most useful functions from the `mosaic` package are listed [here](https://rdrr.io/cran/mosaic/man/aggregating.html) , checkout `favstats()` that computes several statistics at once. 

```{r penguins-image, width=5, echo= FALSE, fig.cap="Artwork by @allison_horst"}

knitr::include_graphics("images/lter_penguins.png")

```


## Always plot your data `r emo::ji("bar_chart")``r emo::ji("chart_increasing")` 

Summary stats are a great starting point but to really understand what is going on with our data we need to visualise it. 

Lets take a look at the below dataset which has x and y values for different groups (recorded as the dataset variable) which are recorded as a character variable.

```{r}
summary(datasaurus_dozen)
```

We can calculate some summary statistics for each group. 

Have a look at the mean and sd for x and y values using dataset as a grouping variable

```{r datasaurus, exercise=TRUE, exercise.completion=FALSE}
# mean and sd of x values in each group

# mean and sd of y values in each group
 
```
<div id="datasaurus-hint">
**Hint** Remember the formula $$\text{statistic(variable ~ group, data= dataset)}$$ 
</div>

It appears that for each group the summary statistics are the same, maybe we can see a difference between the groups when we plot them all? 

```{r datasaurall}
gf_point(y~x, data = datasaurus_dozen, colour =~ dataset)

```

There is a lot going on here, by colouring the points in each dataset differently we can see that there look to be some patterns but there is too much information plotted on top of other information to be of much use. We can make life easier by separating out the different datasets into seperate windows (we call these facets) to get a better idea of what is going on.

```{r datasaur-facet}
gf_point(y~x, data = datasaurus_dozen, colour =~dataset) %>% gf_facet_wrap(~dataset)
```

Even though each of these groups had the same mean and sd values for the points they are quite clearly different when we see them plotted and serve as a good reminder to always plot your data. 

## Data visualisation

one of the most powerful things that you can do with data is to visualise it 

 
 + examples of good/bad plots show the power, show graphics made entirely in R (cedrics stuff?) 


For plotting we will use functions from the `ggformula` package which allow us to create powerful plots with simple code. 
The formula that we will use is similar to the one that we used to generate summary statistics.

For visualising a single variable:

$$\text{plot type(~variable, data= dataset)}$$

For visualising two variables: 

$$\text{plot type(variable y ~ variable x, data= dataset)}$$
Because we are using the `ggformula` package the plotting functions that we will use will be preceeded by `gf_` so for a boxplot we will use `gf_boxplot()` for a bar chart we use `gf_bar()`
We will go through some of the most common plot types that you might want to use but for more detail have a look at different functions [here](https://cran.r-project.org/web/packages/ggformula/vignettes/ggformula.html).

In order to know what plot will be most useful to us we need to first think about the data that we are plotting.
Let's remind ourselves of what is contained within the penguins dataset

```{r}
head(penguins)
```

We have some **categorical** variables: 

+ species
+ island
+ sex

- add note about different data types in R factors/characters?

As well as some **numeric** variables:

+ **continuous**
  - bill_depth_mm
  - bill_length_mm
  - flipper_length_mm
  - body_mass_g
+ **discrete**
  - year
  
It is important to know what type of data we are dealiing with as it will help us to decide what visualisations we might want to create.

## Visualising individual variables

### Numeric data

When investigating a numerical variable we might want to look at the distribution of values (we will talk more about why this is important in the summary statistics lesson) using plots which we could do in a variety of different ways. 

```{r, echo = TRUE, warning=TRUE}
gf_histogram(~body_mass_g, data= penguins)
```

Note that the plot also came with a warning message (remember we had a couple of data points with and NA value) just to let us know that there are some data that were missing and so aren't included in the plot because our plotting function didn't know where to put them.
Going forward these error messages have been hidden from the output so that we can focus purely on the visualisations but it is important to note why they appear. 

Using the `gf_boxplot()` function can you create a boxplot of body mass from the penguins data 

```{r penguin-box, exercise=TRUE, exercise.completion=FALSE}
# Boxplot of penguin body mass 

 
```

### Categorical data

For categorical data we might want to look at how many observations of each category we have using a bar chart

```{r, echo = TRUE, warning=TRUE}
gf_bar(~island, data= penguins)
```


## Visualising multiple variables

When visualising multiple variables we might want to start introducing more shapes or colours into our plots, not only does this make the visualisation more interesting but it can help us to better understand patterns in the data.
Remember that the formula for plotting two variables (one on each axis) is: 

$$\text{plot type(variable_y ~ variable_x, data= dataset)}$$

#### Comparing multiple categorical variables 

We can take our bar chart that showed how many penguins were recorded on each island and we can add information about the species. Using the position argument we can create different plots that show similar information. 
Run the code below to see the output, then change the position argument in the below code to `dodge` and see what the different output looks like.

```{r penguin-dodge, exercise=TRUE, exercise.completion=FALSE}
gf_bar(~island, position= "stack", fill = ~species, data= penguins)
```

<div id="penguin-dodge-hint">
**Hint** Remember that the dodge argument needs to be inside some quotation marks "dodge"
</div>

The `gf_bar()` function gives us counts of our variables in each group, we could change that to show us what proportion of the data are in each category by instead using the `gf_props()` function 

```{r penguin-prop, exercise=TRUE, exercise.completion=FALSE}
gf_props(~island, position= "stack", fill = ~species, data= penguins)
```

This helps us to see that almost half of the data were collected on Biscoe island.

#### Comparing numeric variables most usually involves plotting one against another.
Run the code below to see what  the variables bill length and bill depth look like plotted against one aonther. 
We can add additional information to this plot using the colour and shape arguments.
Can you modify the below code or

```{r penguin-bill, exercise=TRUE, exercise.completion=FALSE}
gf_point(bill_depth_mm ~ bill_length_mm, data= penguins)
```


```{r penguin-bill-solution}
# either
gf_point(bill_depth_mm ~ bill_length_mm, colour = ~species, shape = ~sex, data= penguins)
# or
gf_point(bill_depth_mm ~ bill_length_mm, colour = ~sex, shape = ~species, data= penguins)

```

- adding a line - the detail will be covered in the regression lesson?

plotting measurements through time


Comparing numeric variables across different categorical variables is extremely useful, just like we computed summary statistics across species we can do something similar in our visualisation.

```{r mass-box-sp}
gf_boxplot(body_mass_g~species, data = penguins)
```

Here we can see that the Gentoo penguins are generally heavier than the other species.
To make the plot a bit more informative lets add the  data points in as an extra layer, to do this we are going to use the `gf_sina()` function and an operator this operator` %>% ` which is called the pipe. 

*A quick note about the pipe* The pipe ` %>% ` can be translated as **'then'** and we use it to join together bits of code when doing data manipulation and plotting, when we are using the `ggformula` functions we can use the pipe to add layers to our plot without having to specify things like the x and y variables and the dataset from which we are working for every single layer. 

For example if we take the code that produced the previous plot and add a pipe and smoe more code at the end we are telling R to create the boxplot using the variables and data we have specified THEN add some points (because we have used the pipe R assumes that we are using the same data) on top and shape them according to the sex variable

```{r}
gf_boxplot(body_mass_g~species, data = penguins) %>% 
  gf_sina(shape = ~sex)
```


Lets focus on this plot and look at some of the ways we can tweak it to make it more useful. 
We can see from having added the points that the boxes aren't truly representative of the spread of data, we could use the `gf_violin()` instead of a boxplot to get a better representation of the data.

Can you convert the boxplot to a violin plot by altering the code below

```{r violin, exercise = TRUE, exercise.completion=FALSE}
gf_boxplot(body_mass_g~species, data = penguins) %>% 
  gf_sina(shape = ~sex)
```

a note about the fact that this is density- 

Lets add some colour to the violins and to the points according to the species

```{r violin2, exercise = TRUE, exercise.completion=FALSE}
# add colour to the violins and to the points
gf_violin(body_mass_g~species, data = penguins) %>% 
  gf_sina(shape = ~sex)
```

The `gf_sina()` function 'jitters' the points about the x axis to reduce overplotting but there is still a little bit of overplotting (points of similar value being plotted on top of each other) going on. 
We can use the `alpha` argument to alter the transparency of the geometries in our plot to help make it a bit more asethetically pleasing.
The `alpha` argument takes values between 0-1 with lower values being more transparent.

```{r, echo = TRUE}
gf_violin(body_mass_g~species, colour = ~species, alpha = 0.5,data = penguins) %>% 
  gf_sina(shape = ~sex, colour = ~species, alpha = 0.3)
```

The labels for the x and y axis are simply the variables that we used for the first layer of the plot.
We can tidy them up using the `gf_labs()` function 

```{r, echo = TRUE}
gf_violin(body_mass_g~species, colour = ~species, alpha = 0.5,data = penguins) %>% 
  gf_sina(shape = ~sex, colour = ~species, alpha = 0.3) %>% 
  gf_labs(x = "Penguin species", y = "Body mass (g)")
```

It might be interesting to see how this plot compares across different years. 
We can do this using the `gf_facet_wrap()` function to seperate out plots into side by side comparisons.

Add to the below code to facet the plot according to thee year that the data were collected

```{r facet, exercise = TRUE, exercise.completion= FALSE}
gf_violin(body_mass_g~species, colour = ~species, alpha = 0.5,data = penguins) %>% 
  gf_sina(shape = ~sex, colour = ~species, alpha = 0.3) %>% 
  gf_labs(x = "Penguin species", y = "Body mass (g)")
```

```{r facet-solution}
gf_violin(body_mass_g~species, colour = ~species, alpha = 0.5,data = penguins) %>% 
  gf_sina(shape = ~sex, colour = ~species, alpha = 0.3) %>% 
  gf_labs(x = "Penguin species", y = "Body mass (g)") %>%
  gf_facet_wrap(~year)
  
```


note about ggplot gives more power but needs more code - link to tutorial 



